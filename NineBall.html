<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link rel="stylesheet" href="styles.css">
    <script src="Billiards.js"></script>
    <script src="qrcode.js"></script>
    <script>
        window.addEventListener("resize", onResize);
        window.addEventListener("beforeunload", onUnload);

        class NineBallPlayer extends PlayerWithScore {
            constructor(name, setupFn) {
                super(name, setupFn);
                this.displayName = name;
                this.scores = [];
                this.rackTimeouts = [];
                this.nineSnaps = [];
                this.nineRuns = [];
                this.nineSnap = false;
                this.nineRun = false;
            }

            copy(src) {
                super.copy(src);
                this.displayName = src.displayName;
                this.scores = src.scores;
                this.rackTimeouts = src.rackTimeouts;
                this.nineSnaps = src.nineSnaps;
                this.nineRuns = src.nineRuns;
                this.nineSnap = src.nineSnap;
                this.nineRun = src.nineRun;
                return this;
            }

            clearMatch() {
                this.scores = [];
                this.rackTimeouts = [];
                this.nineSnaps = [];
                this.nineRuns = [];
                super.clearMatch();
                this.clearRack();
            }

            clearRack() {
                super.clearRack();
                this.nineSnap = false;
                this.nineRun = false;
            }
        }

        const player1 = "player1";
        const player2 = "player2";

        class NineBallMatch {
            constructor() {
                this.innings = [];
                this.rackInnings = 0;
                this.matchInnings = 0;
                this.totalInnings = 0;
                this.players = {
                    player1: new NineBallPlayer("Self"),
                    player2: new NineBallPlayer("Opponent")
                }
                this.startingPlayer = player1;
                this.currentPlayer = player1;
                this.ballStates = Array(ballCount).fill("normal");
                this.started = false;
                this.matchTime = new Date();
                this.shotTime = this.matchTime;

            }

            clear() {
                for (const [key, value] of Object.entries(this.players)) {
                    value.clearMatch();
                }
                this.matchInnings = 0;
                this.clearRack();
            }

            clearRack() {
                for (const [key, value] of Object.entries(this.players)) {
                    value.clearRack();
                }
                this.rackInnings = 0;
                this.totalInnings = this.matchInnings;
            }

            addInning() {
                this.rackInnings++;
                this.totalInnings = this.matchInnings + this.rackInnings;
            }

            removeInning() {
                if (this.rackInnings > 0) {
                    this.rackInnings--;
                    this.totalInnings = this.matchInnings + this.rackInnings;
                }
            }

            copy(src) {
                this.innings = src.innings;
                this.rackInnings = src.rackInnings;
                this.matchInnings = src.matchInnings;
                this.totalInnings = src.totalInnings;
                this.players = {
                    player1: new NineBallPlayer().copy(src.players[player1]),
                    player2: new NineBallPlayer().copy(src.players[player2])
                }
                this.startingPlayer = src.startingPlayer;
                this.currentPlayer = src.currentPlayer;
                this.ballStates = src.ballStates;
                this.started = src.started;
                this.matchTime = new Date(src.matchTime);
                this.shotTime = new Date(src.shotTime);

                return this;
            }
        }

        const ballCount = 9;
        const maxTimeouts = 2;
        const apa = [1, 1, 1, 1, 1, 1, 1, 1, 2];
        const apaSuddenDeath = [2, 2, 2, 2, 2, 2, 2, 2, 4];
        const traditional = [0, 0, 0, 0, 0, 0, 0, 0, 1];

        var ballSizeLarge = '20%';
        var ballSizeSmall = '32px';

        var qs = location.search.substring(1).split('&');
        var qqs = {};
        qs.forEach((nvp) => {
            var e = nvp.split('=');
            if (e.length == 2) {
                qqs[e[0].trim()] = e[1].trim();
            }
        });
        var isApa = (!(qqs['style'] === undefined) && qqs['style'].toLowerCase() == 'apa');
        var isSuddenDeath = (!(qqs['sd'] === undefined) && qqs['sd'].toLowerCase() == 'true');
        var isDebug = (!(qqs['debug'] === undefined) && qqs['debug'].toLowerCase() == 'true');
        var values = isApa ? (isSuddenDeath ? apaSuddenDeath : apa) : traditional;

        var balls = {};

        var cycle = {
            "normal": "won",
            "won": "dead",
            "dead": "lost",
            "lost": "normal"
        };

        var invert = {
            "normal": "normal",
            "won": "lost",
            "dead": "dead",
            "lost": "won"
        };

        var match = new NineBallMatch();

        function clearRackIfConfirmed() {
            confirmBox("Reset the current rack?\nThis will clear all scoring for the current rack as if it was never played.", clearRack);
        }

        function clearRack() {
            match.ballStates = Array(ballCount).fill("normal");
            match.clearRack();
            updateBallStates();
            updateScore();

            match.shotTime = new Date();
        }

        function startMatchIfConfirmed() {
            confirmBox("Start a new match\n(clear current status)?", startMatch);
        }

        function endMatchIfConfirmed() {
            confirmBox("End the current match?", endMatch);
        }

        function startMatch() {
            match.ballStates = Array(ballCount).fill("normal");
            match.clear();
            match.startingPlayer = match.currentPlayer;
            match.matchTime = new Date();
            match.shotTime = new Date();
            match.started = true;

            match.innings = [];

            clearRack();
        }

        function endMatch() {
            advanceToNextRack();
            match.started = false;
            showMatch();
        }

        function switchPlayerBalls() {
            for (var i = 0; i < match.ballStates.length; i++) {
                match.ballStates[i] = invert[match.ballStates[i]];
                updateBallState(i + 1);
            }
        }

        function missedShot() {
            if (match.currentPlayer == player1) {
                match.currentPlayer = player2;
            } else {
                match.currentPlayer = player1;
            }
            switchPlayerBalls();
            setCurrentPlayer();

            if (match.currentPlayer == match.startingPlayer) {
                match.addInning();
            }

            resetShotClock();
        }

        function timeout() {
            resetShotClock();
            match.players[match.currentPlayer].timeouts = (match.players[match.currentPlayer].timeouts + 1) % (maxTimeouts + 1);
        }

        function nineSnap() {
            confirmBox("9-Snap ends this rack.\nCancel if you need to mark any additional balls, otherwise proceed to the next rack.", () => {
                match.ballStates[match.ballStates.length - 1] = "won";
                match.players[match.currentPlayer].nineSnap = true;
                updateScore();
                advanceToNextRack();
            });
        }

        function nineRun() {
            confirmBox("9-Run ends this rack.\nPlayer will earn all rack points.", () => {
                for (var i = 0; i < 9; i++) {
                    match.ballStates[i] = "won";
                }
                match.players[match.currentPlayer].nineRun = true;
                updateScore();
                advanceToNextRack();
            });
        }

        function player1Shooting() {
            if (match.currentPlayer != player1) {
                switchPlayerBalls();
                match.currentPlayer = player1;
                setCurrentPlayer();
            }
        }

        function player2Shooting() {
            if (match.currentPlayer != player2) {
                switchPlayerBalls();
                match.currentPlayer = player2;
                setCurrentPlayer();
            }
        }

        function updateScore() {
            var player1RackScore = 0;
            var player2RackScore = 0;
            var parent1 = document.getElementById("player1-balls");
            while (parent1.firstChild) {
                parent1.firstChild.remove();
            }
            var parent2 = document.getElementById("player2-balls");
            while (parent2.firstChild) {
                parent2.firstChild.remove();
            }
            for (var i = 0; i < match.ballStates.length; i++) {
                var ballState = match.ballStates[i];
                if ((match.currentPlayer == player1 && ballState == "won") || (match.currentPlayer == player2 && ballState == "lost")) {
                    player1RackScore += values[i];
                    parent1.appendChild(new BilliardBall(i + 1, ballSizeSmall).element);
                }
                if ((match.currentPlayer == player1 && ballState == "lost") || (match.currentPlayer == player2 && ballState == "won")) {
                    player2RackScore += values[i];
                    parent2.appendChild(new BilliardBall(i + 1, ballSizeSmall).element);
                }
            }

            match.players[player1].rackScore = player1RackScore;
            match.players[player2].rackScore = player2RackScore;

            for (const [key, value] of Object.entries(match.players)) {
                if (value.neededToWin > 0 && (value.matchScore + value.rackScore) > value.neededToWin) {
                    value.rackScore = value.neededToWin - value.matchScore;
                }
                value.score = value.matchScore + value.rackScore;
        }
        }

        function advanceToNextRack() {
            if (match.rackInnings > 0 || match.ballStates.some(b => b != "normal") || Object.values(match.players).some(p => p.rackScore > 0 || p.timeouts > 0 || p.rackDefensives > 0 || p.nineSnap || p.nineRun)) {
               for (const [key, value] of Object.entries(match.players)) {
                    value.matchScore += value.rackScore;
                    value.scores.push(value.rackScore);
                    value.rackTimeouts.push(value.timeouts);
                    value.nineSnaps.push(value.nineSnap);
                    value.nineRuns.push(value.nineRun);
                    value.matchDefensives += value.rackDefensives;
                    value.rackScore = 0;
                    }
                match.innings.push(match.rackInnings);
                match.matchInnings += match.rackInnings;
                    }
                clearRack();
                updateScore();
        }

        function nextRack() {
            var hasWinner = Object.values(match.players).every(v => v.neededToWin > 0) && Object.values(match.players).some(v => v.remaining == 0);
            var missingBalls = match.ballStates.some(b => b == "normal") && !Object.values(match.players).some(v => v.remaining == 0);
            var warning = missingBalls ? 'WARNING\nYou have not marked all balls.' : "Make sure scoring for this rack is correct before you proceed; you won't be able to edit it later.";
            confirmBox((hasWinner ? "Record final rack?\n" : "Advance to the next rack?\n") + warning, advanceToNextRack);
        }

        function setCurrentPlayer() {
            var player1Cue = document.getElementById("player1-cue");
            var player2Cue = document.getElementById("player2-cue");
            var player1Input = document.getElementById("player1-input");
            var player2Input = document.getElementById("player2-input");
            if (match.currentPlayer == player1) {
                player1Cue.style.visibility = "visible";
                player2Cue.style.visibility = "hidden";
                player1Input.style.fontWeight = "bold";
                player2Input.style.fontWeight = "normal";
            } else {
                player1Cue.style.visibility = "hidden";
                player2Cue.style.visibility = "visible";
                player1Input.style.fontWeight = "normal";
                player2Input.style.fontWeight = "bold";
            }
        }

        function updateBallStates() {
            for (var i = 0; i < match.ballStates.length; i++) {
                updateBallState(i + 1);
            }
        }

        function updateBallState(number) {
            var currentBallState = match.ballStates[number - 1];
            var ball = balls[number];

            switch (currentBallState) {
                case "normal":
                    ball.showNormal();
                    break;

                case "dead":
                    ball.showFoul();
                    break;

                default:
                    ball.showPocketed(currentBallState == "won");
                    break;
            }
        }

        function createScoresRow(player) {
            var row = document.createElement('tr');
            var hdr = document.createElement('td');
            hdr.style.fontWeight = 'bold';
            hdr.innerText = player.displayName;
            row.appendChild(hdr);
            for (var i = 0; i < player.scores.length; i++) {
                var cell = document.createElement('td');
                cell.innerText = player.scores[i].toString();
                if (player.nineSnaps[i]) {
                    var ns = document.createElement('small');
                    ns.innerText = '(9-Snap)';
                    cell.appendChild(ns);
                }
                if (player.nineRuns[i]) {
                    var nr = document.createElement('small');
                    nr.innerText = '(9-Run)';
                    cell.appendChild(nr);
                }
                if (player.rackTimeouts[i] > 0) {
                    var to = document.createElement('sup');
                    to.innerText = 'T'.repeat(player.rackTimeouts[i]);
                    cell.appendChild(to);
                }
                row.appendChild(cell);
            }
            return row;
        }

        function showMatch() {
            var info = document.getElementById('summaryInfo');
            //var qr = document.getElementById('qr');

            //while (qr.firstChild) {
            //    qr.firstChild.remove();
            //}

            //var str = JSON.stringify(match);
            //var str2 = utf8_to_b64(str);
            //new QRCode(qr, str2);

            const options = {
                weekday: "long",
                month: "long",
                day: "numeric",
                year: "numeric",
                hour: "numeric",
                minute: "2-digit",
                hour12: true
            };

            info.innerText = 'Started ' + match.matchTime.toLocaleString("en-US", options);

            var table = document.getElementById('running-score');
            while (table.firstChild) {
                table.firstChild.remove();
            }

            table.appendChild(createScoresRow(match.players[player1]));
            var row = document.createElement('tr');
            var hdr = document.createElement('td');
            hdr.innerText = 'Innings';
            row.appendChild(hdr);
            for (var i = 0; i < match.innings.length; i++) {
                var cell = document.createElement('td');
                cell.innerText = match.innings[i].toString();
                row.appendChild(cell);
            }
            table.appendChild(row);
            row = document.createElement('tr');
            hdr = document.createElement('td');
            hdr.innerText = 'Dead';
            row.appendChild(hdr);
            var rackPoints = values.reduce((sum, i) => sum + i);
            for (var j = 0; j < match.players[player1].scores.length; j++) {
                var cell2 = document.createElement('td');
                cell2.innerText = (rackPoints - (match.players[player1].scores[j] + match.players[player2].scores[j])).toString();
                row.appendChild(cell2);
            }
             table.appendChild(row);
            table.appendChild(createScoresRow(match.players[player2]));

            document.getElementById('matchInfo').style.visibility = 'visible';
        }

        function ballClick(number) {
            var currentBallState = match.ballStates[number - 1];

            var nextBallState = cycle[currentBallState];
            match.ballStates[number - 1] = nextBallState;

            updateBallState(number);
            updateScore();
            resetShotClock();
        }

        function addMiss(parentId, size) {
            var parentElement = document.getElementById(parentId);
            parentElement.appendChild(new CueBall(size, "End Turn", missedShot).element);
        }

        function addTimeout(parentId, size) {
            var parentElement = document.getElementById(parentId);
            parentElement.appendChild(new CueBall(size, "Time-out", timeout, "yellow").element);
        }

        function add9Snap(parentId, size) {
            var parentElement = document.getElementById(parentId);
            parentElement.appendChild(new BilliardBallWithClick(9, size, nineSnap, "Snap").element);
        }

        function add9Run(parentId, size) {
            var parentElement = document.getElementById(parentId);
            parentElement.appendChild(new BilliardBallWithClick(9, size, nineRun, "Run").element);
        }

        function addRack(parentId, size) {
            var parentElement = document.getElementById(parentId);
            parentElement.appendChild(new Rack(size, "Next Rack", nextRack).element);
        }


        function addBalls(elementId) {
            var parentElement = document.getElementById(elementId);
            for (var i = 1; i <= ballCount; i++) {

                balls[i] = new BilliardBallWithState(i, ballSizeLarge, ballClick, 'DEAD');
                parentElement.appendChild(balls[i].element);
            }

            addMiss(elementId, ballSizeLarge);
            addTimeout(elementId, ballSizeLarge);
            add9Snap(elementId, ballSizeLarge);
            add9Run(elementId, ballSizeLarge);
            addRack(elementId, ballSizeLarge);
        }

        function initialCaps(str) {
            return str[0].toUpperCase() + str.substring(1);
        }

        function getCookie(cname) {
            let name = cname + "=";
            let decodedCookie = decodeURIComponent(document.cookie);
            let ca = decodedCookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }

        function onLoad() {
            var cookie = getCookie(isApa ? 'apa-nineball-match' : 'classic-nineball-match');
            load(cookie);
            document.title = isApa ? 'Scoreboard for APA-Style 9-Ball' : 'Scoreboard for Classic 9-Ball';
            addBalls("balls");
            updateBallStates();
            onResize();
            setInterval(updateClock, 1000);
        }

        function load(cookie, finalizeFn) {
            if (!(cookie === undefined) && cookie.length > 0) {
                match = new NineBallMatch().copy(JSON.parse(cookie));
            }

            document.getElementById("helpOrDebug").innerText = isDebug ? 'Debug' : 'Help';

            var player1Obj = match.players[player1];
            bindInput(player1Obj,
                "name",
                document.getElementById("player1-input"),
                function () {
                    var name = player1Obj.name;
                    player1Obj.displayName = initialCaps(name);
                    if (player1Obj.displayName != name) {
                        player1Obj.name = player1Obj.displayName;
                    };
                });
            var player2Obj = match.players[player2];
            bindInput(player2Obj, "name", document.getElementById("player2-input"), function () {
                var name = player2Obj.name;
                player2Obj.displayName = initialCaps(name);
                if (player2Obj.displayName != name) {
                    player2Obj.name = player2Obj.displayName;
                };
            });

            bindInput(match.players[player1], "neededToWin", document.getElementById("player1-goal"), function () {
                match.players[player1].updateScore();
            });

            bindInput(match.players[player2], "neededToWin", document.getElementById("player2-goal"), function () {
                match.players[player2].updateScore();
            });

            bindOutput(match.players[player1], "score", document.getElementById("player1-score"), function () {
                match.players[player1].updateScore();
            });
            bindOutput(match.players[player2], "score", document.getElementById("player2-score"), function () {
                match.players[player2].updateScore();
            });

            bindOutput(match.players[player1], "totalDefensives", document.getElementById("player1-defensives"));
            bindOutput(match.players[player2], "totalDefensives", document.getElementById("player2-defensives"));

            bindOutput(match.players[player1], "remaining", document.getElementById("player1-needs"));
            bindOutput(match.players[player2], "remaining", document.getElementById("player2-needs"));

            bindOutput(match.players[player1], "timeouts", document.getElementById("player1-timeouts"));
            bindOutput(match.players[player2], "timeouts", document.getElementById("player2-timeouts"));

            bindOutput(match, "rackInnings", document.getElementById("rack-innings"));
            bindOutput(match, "totalInnings", document.getElementById("match-innings"));

            setCurrentPlayer();
            updateScore();

            if (!(finalizeFn === undefined)) {
                finalizeFn();
            }
        }

        function onUnload() {
            var json = JSON.stringify(match);
            var result = new Date();
            result.setDate(result.getDate() + 30);
            var expiry = result.toString();
            var cookie = (isApa ? 'apa-nineball-match' : 'classic-nineball-match') + "=" + json + "; expires=" + expiry + ";";
            document.cookie = cookie;
        }

        function reload() {
            var json = JSON.stringify(match);
            match = void 0;
            load(json, updateBallStates);
        }

        function utf8_to_b64(str) {
            return window.btoa(unescape(encodeURIComponent(str)));
        }

        function b64_to_utf8(str) {
            return decodeURIComponent(escape(window.atob(str)));
        }

        function onResize() {
            var width = document.documentElement.clientWidth;
            if (width > 1000) {
                ballSizeLarge = '9%';
                ballSizeSmall = '32px';
            } else if (width > 800) {
                ballSizeLarge = '9%';
                ballSizeSmall = '30px';
            } else if (width > 600) {
                ballSizeLarge = '20%';
                ballSizeSmall = '25px';
            } else {
                ballSizeLarge = '20%';
                ballSizeSmall = '20px';
            }

            var parentElement = document.getElementById("balls");
            parentElement.querySelectorAll('svg').forEach(function (svg) {
                svg.setAttribute('width', ballSizeLarge);
            });

            updateScore();
        }

        function resetShotClock() {
            match.shotTime = new Date();
        }

        function updateClock() {
            var todClock = document.getElementById("todClock");
            var now = new Date();

            todClock.innerText = now.toLocaleTimeString("en-US", {
                hour: "numeric",
                minute: "2-digit",
                hour12: true
            });

            if (match.started) {
                var shotElapsed = (now - match.shotTime) / 1000;
                var matchElapsed = (now - match.matchTime) / 60000;
                var shotClock = document.getElementById("shotClock");
                var matchClock = document.getElementById("matchClock");
                shotClock.innerText = Math.round((shotElapsed / 60)).toString() + ":" +
                    Math.round((shotElapsed % 60)).toString().padStart(2, '0');
                matchClock.innerText = Math.round((matchElapsed / 60)).toString() + ":" +
                    Math.round((matchElapsed % 60)).toString().padStart(2, '0');
            }
        }

        var popupAction;

        function onPopupOkClick(id) {
            document.getElementById(id).style.visibility = 'hidden';
            popupAction();
        }

        function confirmBox(message, action) {
            document.getElementById('popupMessage').innerText = message;
            popupAction = action;
            document.getElementById('popup').style.visibility = 'visible';
        }

        function helpOrDebug() {
            if (isDebug) {
                // for now, just reload cookie... nothing else needed
                reload();
            } else {
                // Help
                window.open("NineBallHelp.html");
            }
        }
    </script>
</head>
<body onload='onLoad()'>
    <div class="main" style="background-color: lightblue; min-height: 100vh;">
    <table>
        <tr>
            <td>
                <button onclick="startMatchIfConfirmed()">Start Match</button>
            </td>
                <td>
                    <button onclick="endMatchIfConfirmed()"><small>End Match</small></button>
                </td>
            <td style="text-align: center">Total Innings</td>
            <td style="text-align: center">Rack Innings</td>
        </tr>
        <tr>
            <td>
                <button onclick="clearRackIfConfirmed()">Clear Rack</button>
            </td>
                <td>
                    <button onclick="showMatch()"><small>Summary</small></button>
                </td>
            <td style="text-align: center">
                <span id="match-innings">0</span>
            </td>
            <td style="text-align: center">
                <span id="rack-innings">0</span>
                    <button onclick="match.addInning()"><b>+</b></button>
                    <button onclick="match.removeInning()"><b>-</b></button>
            </td>

        </tr>
    </table>
    <table class="player">
        <tr>
                <td>Player &amp;<br />Current Shooter</td>
                <td style="vertical-align: bottom">Score</td>
                <td>Current<br />Rack</td>
                <td><small>Defensives<br />&amp;timeouts</small></td>
        </tr>
        <tr>
            <td class="player-cell">
                <div style="display: flex; white-space: nowrap">
                    <button style="vertical-align: middle; background: transparent; border: gray;" onclick="player1Shooting()">
                        <svg id="player1-cue" width="25" height="25" style="vertical-align: bottom; visibility: visible; filter: drop-shadow(3px 3px 3px)"><circle cx="11" cy="11" r="10" style="fill: white; stroke: black; stroke-width: 1px" /></svg>
                    </button>
                    &nbsp;
                    <input type="text" id="player1-input" size="8" style="background: transparent; border: transparent;" />
                </div>
                <div class="points-needed">
                    <small>Needs&nbsp;</small>
                    <span id="player1-needs">0</span>/
                    <input type="number" min="0" max="99" id="player1-goal" style="background: transparent; border: transparent;" />
                </div>
            </td>
                <td class="player-cell" style="text-align: center; padding-top: 5px;"><span id="player1-score">0</span></td>
                <td class="player-cell">
                    <div id="player1-balls" style="padding-top: 3px; padding-left: 3px;"></div>
                </td>
                <td class="player-cell" style="text-align: center; padding-top: 3px;">
                <span id="player1-defensives">0</span>
                    <button class="player-button" onclick="(() => { match.players[player1].addDefensive() })()"><b>+</b></button>
                    <button class="player-button" onclick="(() => { match.players[player1].removeDefensive() })()"><b>-</b></button>
                    <br /><small>t/o:&nbsp;<span id="player1-timeouts">0</span></small>
            </td>
        </tr>
        <tr>
            <td class="player-cell">
                <div style="display: flex; white-space: nowrap">
                    <button style="vertical-align: middle; background: transparent; border: gray;" onclick="player2Shooting()">
                        <svg id="player2-cue" width="25" height="25" style="vertical-align: bottom; visibility: hidden; filter: drop-shadow(3px 3px 3px)"><circle cx="11" cy="11" r="10" style="fill: white; stroke: black; stroke-width: 1px" /></svg>
                    </button>
                    &nbsp;
                    <input type="text" id="player2-input" size="8" style="background: transparent; border: transparent;" />
                </div>
                <div class="points-needed">
                    <small>Needs&nbsp;</small>
                        <span id="player2-needs">0</span>/
                    <input type="number" min="0" max="99" id="player2-goal" style="background: transparent; border: transparent;" />
                </div>
            </td>
            <td class="player-cell" style="text-align: center; padding-top: 5px;"><span id="player2-score">0</span></td>
                <td class="player-cell">
                    <div id="player2-balls" style="padding-top: 3px; padding-left: 3px;"></div>
                </td>
                <td class="player-cell" style="text-align: center; padding-top: 3px">
                <div class="defensives">
                    <span id="player2-defensives">0</span>
                        <button class="player-button" onclick="(() => { match.players[player2].addDefensive() })()"><b>+</b></button>
                        <button class="player-button" onclick="(() => { match.players[player2].removeDefensive() })()"><b>-</b></button>
                        <br /><small>t/o:&nbsp;<span id="player2-timeouts">0</span></small>
                </div>
            </td>
        </tr>
    </table>
        <div id="balls" style="padding: 10px;">
    </div>
    <div id="clocks">
        <table>
            <tr>
                    <td><button onclick="resetShotClock()">Shot</button></td>
                    <td>Match</td>
                    <td>
                        <button id="helpOrDebug" onclick="helpOrDebug()">Help</button>
                    </td>
            </tr>
            <tr>
                <td><span id="shotClock">0:00</span></td>
                <td><span id="matchClock">0:00</span></td>
                <td><span id="todClock">0:00</span></td>
            </tr>
        </table>
    </div>
        <div id="popup" class="popupBackground" style="visibility: hidden">
            <div class="popup">
                <p id="popupMessage" style="text-align: center"></p>
                <div class="popupButtons">
                    <button onclick="onPopupOkClick('popup')">OK</button>&nbsp;<button onclick="(() => { document.getElementById('popup').style.visibility = 'hidden' })()">Cancel</button>
                </div>
            </div>
        </div>

        <div id="matchInfo" class="popupBackground" style="visibility: hidden">
            <div class="popup-large">
                <p align="center">Summary of Completed Racks<br /><small> <small><span id="summaryInfo"></span><br />(Best viewed in landscape orientation)</small></small></p>
 
                <div class="div-running-score">
                    <table id="running-score" class="running-score">
                    </table>
                </div>
                <!--<div id="qr"></div>-->
                <div class="popupButtons">
                    <button onclick="(() => { document.getElementById('matchInfo').style.visibility = 'hidden' })()">OK</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>